# 功能規格：相關點子連結（Related Ideas Linking）

**Feature Branch**: `001-related-ideas-linking`  
**Created**: 2025-10-28  
**Status**: Draft  
**Input**: User description: "我想建立一個可以收集 ideas 的 iOS app，每當提交新的 idea，可以找出在過往所有 ideas 中有哪些是相關的 idea。 建立連結，並以列表清單方式顯示，點擊後可以 focus，然後再查看該 idea 的延伸連結，ideas 之間的關係是雙向的"

## Clarifications

### Session 2025-10-28
- Q: 語意相似度的語言範圍？ → A: 中文（繁/簡）+ 英文（中英雙語優先，可擴充）
- Q: 關聯重算時機？ → A: 儲存時重算
- Q: 顯示門檻策略？ → A: Top-N 並需達到門檻
- Q: 手動移除的關聯是否應永久不再被建議？ → A: 永久不再建議（可手動恢復）
- Q: 手動建立的關聯是否固定顯示（優先於演算法）？ → A: 固定顯示且優先（Pinned）

## User Scenarios & Testing *(mandatory)*

<!--
  IMPORTANT: User stories should be PRIORITIZED as user journeys ordered by importance.
  Each user story/journey must be INDEPENDENTLY TESTABLE - meaning if you implement just ONE of them,
  you should still have a viable MVP (Minimum Viable Product) that delivers value.
  
  Assign priorities (P1, P2, P3, etc.) to each story, where P1 is the most critical.
  Think of each story as a standalone slice of functionality that can be:
  - Developed independently
  - Tested independently
  - Deployed independently
  - Demonstrated to users independently

  依據專案憲章，所有 P1 使用者故事必須至少包含一個可執行的驗收測試，
  並能以 XCTest（單元或 UI）實作。下列驗收情境需能對應至這些測試。
-->

### User Story 1 - 新增後顯示相關點子（P1）

當我提交一個新的 idea，系統會在既有 ideas 中找出「相關」的點子並以列表顯示；
我可以點擊其中一個相關點子進入焦點檢視，並在該頁面看到它的延伸連結（雙向關係可被探索）。

**Why this priority**: 直接提升新增想法後的探索效率，幫助使用者快速整理、連結知識與靈感。

**Independent Test**: 於測試資料集中預先存在多筆相似主題的 ideas；
當新增一筆含相同主題關鍵詞/語意的 idea 後，驗證系統顯示相關清單、可點擊導覽至焦點檢視，且可檢視延伸連結並返回。

**Acceptance Scenarios**:

1. Given 已存在多筆與「主題A」相關的 ideas；When 我新增一筆含「主題A」的新 idea；Then 我看到相關清單（依相關度排序）。
2. Given 相關清單已顯示；When 我點擊其中一筆；Then 進入該 idea 的焦點檢視並看到它的延伸連結清單。
3. Given 焦點檢視顯示延伸連結；When 我點擊返回；Then 回到新增後的相關清單頁，狀態保持。

---

### User Story 2 - 既有點子的相關清單與延伸探索（P2）

在瀏覽任何既有 idea 時，我可以查看其相關點子列表，並進一步點擊進入其他 idea 的焦點檢視，
用來探索整體脈絡（雙向）。

**Why this priority**: 強化日常瀏覽時的探索能力，不需一定從「新增」入口才能串聯想法。

**Independent Test**: 選擇一筆已有既知關聯的 idea；驗證其相關清單顯示與導覽，並可持續探索下一層延伸連結。

**Acceptance Scenarios**:

1. Given 我打開一筆既有 idea；When 我切換到「相關」區塊；Then 我看到相關清單，排序合理。
2. Given 相關清單存在；When 我點擊其中一筆；Then 進入該 idea 焦點檢視並可看到其延伸連結。

---

### User Story 3 - 手動維護關聯（P3）

我可以對系統建議的關聯進行手動新增、移除或覆寫，以精煉專屬於我的知識連結；
系統需自動維持雙向一致性（A 關聯 B，即 B 亦關聯 A）。

**Why this priority**: 讓使用者能調整自動建議，提升長期資料品質與個人化價值。

**Independent Test**: 在焦點檢視介面手動新增/移除一條關聯；驗證另一端也即時反映，並在相關清單中同步更新。

**Acceptance Scenarios**:

1. Given 我在 idea A 的焦點檢視；When 我手動新增 A 與 B 的關聯；Then 我在 A 與 B 的相關清單皆看到對方。
2. Given 已存在 A 與 B 的關聯；When 我在 A 移除該關聯；Then B 的相關清單也不再顯示 A。

---

### Edge Cases

- 新增的 idea 沒有任何可辨識的相關點子 → 顯示友善空狀態與引導。
- 建議清單過長 → 限制上限並提供排序；支援延遲載入或分頁（視設計）。
- 重複與循環關聯 → 去重與一致性維護（A↔B 不重覆顯示）。
- 相似度誤判 → 提供手動調整（移除/新增）以修正。
- 內容極短或極長的 idea → 仍須有合理預設行為；極短時可能無建議；極長時保證反應時間在目標內。

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 使用者提交新 idea 後，系統必須即時產生「相關點子清單」。
- **FR-002**: 系統必須為每一條關係建立雙向關聯紀錄（A↔B）。
- **FR-003**: 相關清單項目必須顯示標題與摘要，並依相關度由高至低排序；清單長度預設上限為 10，且可由使用者在 5–20 範圍內調整（偏好設定需持久化）。
- **FR-004**: 使用者點擊清單項目時，必須進入該 idea 之「焦點檢視」，並顯示其延伸連結清單，且可返回上一畫面。
- **FR-005**: 系統必須對關聯對（A,B）進行去重，避免重覆呈現或造成循環錯誤。
- **FR-006**: 當無相關結果時，必須顯示清楚的空狀態與下一步引導（例如：編輯內容、加入標籤等）。
- **FR-007**: 使用者必須可以手動新增、移除或覆寫關聯（至少於焦點檢視進行）；系統自動維持雙向一致性（P3）。
- **FR-008**: 效能要求：在標準條件下（正常資料量、現代裝置），相關清單首次顯示時間 ≤ 1 秒（p95）。
- **FR-009**: 無障礙要求：清單項、操作與回饋具可讀替代敘述；以螢幕閱讀器可完成新增後檢視、導覽與返回的核心流程。
- **FR-010**: 系統必須記錄使用者對建議關聯的接受/移除行為（僅用於後續改善建議品質；不得暴露個資）。
- **FR-011**: 相關度判定方式必須採用「語意相似度」：於裝置端以語意相似度方法計算（例如對標題/描述建立向量並比較），並提供可調參數（如相似度閾值、標題/描述權重）；「語言範圍」初始支援中文（繁/簡）與英文，後續可擴充並需伴隨測試資料更新與文件化。
- **FR-012**: 建議清單上限 N 之預設值為 10，且可由使用者在 5–20 範圍內調整；調整介面需清楚，並確保變更即時生效與持久化。
- **FR-013**: 隱私/離線策略：所有相關度計算與關聯維護必須「完全在裝置端」完成；不得上傳內容或個人資料至伺服器；功能需於離線狀態可用。
- **FR-014**: 重算觸發：當 idea 內容變更「被儲存」時，系統必須重算相關度並更新相關清單；打字過程中不得即時重算；不進行背景定時重算（後續若需另行提案）。
- **FR-015**: 顯示門檻策略：候選集合必須先通過相似度門檻（τ），再依相關度排序取前 N（N 預設 10，使用者可調 5–20）；若通過門檻者少於 N，顯示實際通過者；若為 0，顯示空狀態與引導。τ 的預設與調整機制須文件化（可作為偏好設定）。
- **FR-016**: 手動移除後不再建議：當使用者手動移除 A↔B 關聯時，系統必須將該對（A,B）加入「不再建議」清單（裝置端、對稱生效），後續重算不得再自動建議；需提供明確的「恢復建議」入口（於焦點檢視或設定），一旦恢復，該對即自黑名單移除並回到一般建議流程中。
- **FR-017**: 手動建立關聯之顯示與排序（Pinned）：使用者手動建立的 A↔B 關聯必須「固定顯示且優先」於相關清單頂端，不受相似度門檻（τ）限制，且「不佔用」Top‑N 配額（N）；Pinned 區塊與演算法建議區塊的分組/樣式需清楚可辨。移除手動關聯即取消 Pinned 身份，之後是否出現在建議清單由演算法與門檻決定。

### Key Entities *(include if feature involves data)*

- **Idea**：代表一個點子，包含（概念性）識別、標題、描述、完成狀態與建立/更新資訊；可連結至多個相關 Idea。
- **IdeaLink**：代表兩個 Idea 間的雙向關聯，包含（概念性）來源（自動/手動）、相關度／信心分數、建立時間與最後更新。

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 在資料集中存在相似內容時，新增後 90% 的案例可顯示 ≥1 筆相關結果（內部測試條件下）。
- **SC-002**: 95% 的使用者可於首次嘗試完成：從新增完成 → 查看相關清單 → 進入焦點檢視 → 返回。
- **SC-003**: 新增後相關清單的呈現時間 ≤ 1 秒（p95）。
- **SC-004**: 可用性/滿意度：至少 80% 內部測試受試者認為相關結果有助於整理想法（問卷或可用性測試）。
- **SC-005**: 無障礙：使用螢幕閱讀器可完成 P1 核心流程，且無阻滯步驟（由 QA 腳本驗證）。
